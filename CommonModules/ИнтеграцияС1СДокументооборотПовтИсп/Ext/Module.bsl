////////////////////////////////////////////////////////////////////////////////
// Подсистема "Интеграция с 1С:Документооборотом"
// Модуль ИнтеграцияС1СДокументооборотБазоваяФункциональностьПовтИсп, сервер, повт. использование
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныеПроцедурыИФункции

// Возвращает массив типов объектов ИС, для которых заданы правила интеграции.
//
// Параметры:
//   ТипыОбъектовДО - Строка - список типов через запятую.
//
// Возвращаемое значение:
//   Массив из Тип
//
Функция ПолучитьТипыОбъектовСПравиламиИнтеграции(ТипыОбъектовДО) Экспорт
	
	Результат = Новый Массив;
	
	МассивТипов = Новый Массив;
	Для Каждого Строка Из СтрРазделить(ТипыОбъектовДО, ",", Ложь) Цикл
		МассивТипов.Добавить(СокрЛП(Строка));
	КонецЦикла;
	
	Запрос = Новый Запрос(
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ТипОбъектаИС КАК ТипСтрокой
		|ИЗ
		|	Справочник.ПравилаИнтеграцииС1СДокументооборотом КАК Правила
		|ГДЕ
		|	НЕ Правила.ПометкаУдаления
		|	И Правила.ТипОбъектаДО В (&МассивТипов)");
	Запрос.УстановитьПараметр("МассивТипов", МассивТипов);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		Если СтрНачинаетсяС(Выборка.ТипСтрокой, "Справочник.") Тогда
			ТипСтрокой = "СправочникСсылка." + Сред(Выборка.ТипСтрокой,
				СтрДлина("Справочник.") + 1);
		ИначеЕсли СтрНачинаетсяС(Выборка.ТипСтрокой, "Документ.") Тогда
			ТипСтрокой = "ДокументСсылка." + Сред(Выборка.ТипСтрокой,
				СтрДлина("Документ.") + 1);
		ИначеЕсли СтрНачинаетсяС(Выборка.ТипСтрокой, "ПланСчетов.") Тогда
			ТипСтрокой = "ПланСчетовСсылка." + Сред(Выборка.ТипСтрокой,
				СтрДлина("ПланСчетов.") + 1);
		ИначеЕсли СтрНачинаетсяС(Выборка.ТипСтрокой, "ПланВидовРасчета.") Тогда
			ТипСтрокой = "ПланВидовРасчетаСсылка." + Сред(Выборка.ТипСтрокой,
				СтрДлина("ПланВидовРасчета.") + 1);
		ИначеЕсли СтрНачинаетсяС(Выборка.ТипСтрокой, "ПланВидовХарактеристик.") Тогда
			ТипСтрокой = "ПланВидовХарактеристикСсылка." + Сред(Выборка.ТипСтрокой,
				СтрДлина("ПланВидовХарактеристик.") + 1);
		ИначеЕсли СтрНачинаетсяС(Выборка.ТипСтрокой, "БизнесПроцесс.") Тогда
			ТипСтрокой = "БизнесПроцессСсылка." + Сред(Выборка.ТипСтрокой,
				СтрДлина("БизнесПроцесс.") + 1);
		ИначеЕсли СтрНачинаетсяС(Выборка.ТипСтрокой, "Задача.") Тогда
			ТипСтрокой = "ЗадачаСсылка." + Сред(Выборка.ТипСтрокой, СтрДлина("Задача.") + 1);
		Иначе
			Продолжить;
		КонецЕсли;
		
		// Устаревшие типы в правилах не должны приводить к неработоспособности связей.
		Попытка
			ТипОбъекта = Тип(ТипСтрокой);
		Исключение
			Продолжить;
		КонецПопытки;
		
		Если Не ПравоДоступа("Чтение", Метаданные.НайтиПоТипу(ТипОбъекта)) Тогда
			Продолжить;
		КонецЕсли;
		
		Результат.Добавить(ТипОбъекта);
		
	КонецЦикла;
		
	Возврат Результат;
	
КонецФункции

// Возвращает Истина, если используется термин "Корреспонденты".
//
// Возвращаемое значение:
//   Булево
//
Функция ИспользоватьТерминКорреспонденты() Экспорт
	
	Возврат Не ИнтеграцияС1СДокументооборотБазоваяФункциональностьПовтИсп.ДоступенФункционалВерсииСервиса("2.1.0.1", Истина);
	
КонецФункции

#КонецОбласти